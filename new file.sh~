#!/bin/bash

#SBATCH --job-name=stan_array
#SBATCH --ntasks=1
#SBATCH --nodes=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=1G
#SBATCH --partition=day-long-cpu,week-long-cpu,month-long-cpu
#SBATCH --output=/projects/niubilitydiu93/yunong/output/results/EEG_multi/%A_%a.out.txt 
#SBATCH --mail-user=yunong.wu@emory.edu
#SBATCH --mail-type=BEGIN,END,FAIL
#SBATCH --error=/projects/niubilitydiu93/yunong/output/logs/EEG_multi/%A_%a.err.txt  # 包含作业数组ID
#SBATCH --array=0  # 假设你想并行执行100个任务
#SBATCH --time=4-00:00:00  # 设置时间限制为4天

module load python/3.11

VENV_PATH=/projects/niubilitydiu93/yunong/py/proj1

if [ ! -d "$VENV_PATH" ]; then
    echo "Creating virtual environment..."
    mkdir -p /projects/niubilitydiu93/yunong/py
    python3 -m venv $VENV_PATH
    source $VENV_PATH/bin/activate
    pip install --upgrade cmdstanpy[all]
    pip install scipy
    pip install -U scikit-learn
    pip install matplotlib
else
    echo "Virtual environment already exists."
    source $VENV_PATH/bin/activate
fi

# 使用 $SLURM_ARRAY_TASK_ID 作为参数运行你的Python脚本
srun python /projects/niubilitydiu93/yunong/EEG_multi_pyro_GP.py $SLURM_ARRAY_TASK_ID

